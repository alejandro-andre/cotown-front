<app-spinner-control *ngIf="isViewLoading"></app-spinner-control>

<h1>{{ 'booking_detail' | translate }}</h1>

<div *ngIf="booking.id; then thenBlock else elseBlock"></div>

<ng-template #thenBlock>

  <h2>{{ 'booking_detail' | translate }}</h2>

  <div class="group">
    <div class="pure-g">

      <div class="pure-u-1">
        <mat-form-field>
          <mat-label>{{ 'status' | translate }}</mat-label>
          <input matInput placeholder="{{ 'status' | translate }}" [ngModel]="status">
        </mat-form-field>
      </div>

      <div class="pure-u-1">
        <button *ngIf="true" mat-raised-button (click)="discart()">
          {{ 'discart' | translate }}
        </button>
      </div>

      <div class="pure-u-1">
        <mat-form-field>
          <mat-label>{{ 'payer' | translate }}</mat-label>
          <input matInput placeholder="{{'payer' | translate}}" [(ngModel)]="booking.payer.name" >
        </mat-form-field>
      </div>

      <div class="pure-u-1">
      </div>

    </div>    
  </div>

  <h2>{{ 'dates' | translate }}</h2>
  <div class="group">
    <div class="pure-g">

      <div class="pure-u-1-2 pure-u-lg-1-5">
        <mat-form-field>
          <mat-label>{{ 'date_from' | translate }}</mat-label>
          <input matInput readonly placeholder="{{'date_from' | translate}}" [(ngModel)]="booking.date_from">
        </mat-form-field>
      </div>

      <div class="pure-u-1-2 pure-u-lg-1-5">
        <mat-form-field>
          <mat-label>{{ 'date_to' | translate }}</mat-label>
          <input matInput readonly placeholder="{{'date_to' | translate}}" [(ngModel)]="booking.date_to">
        </mat-form-field>
      </div>

      <div class="pure-u-1-2 pure-u-lg-1-5">
        <mat-form-field>
          <mat-label>{{ 'application_date' | translate }}</mat-label>
          <input matInput readonly placeholder="{{'application_date' | translate}}" [(ngModel)]="booking.request_date">
        </mat-form-field>
        </div>

      <div class="pure-u-1-2 pure-u-lg-1-5">
        <mat-form-field>
          <mat-label>{{ 'valid_until' | translate }}</mat-label>
          <input matInput readonly placeholder="{{'valid_until' | translate}}" [(ngModel)]="booking.expiry_date">
        </mat-form-field>
      </div>

      <div class="pure-u-1-2 pure-u-lg-1-5">
        <mat-form-field>
          <mat-label>{{ 'confirmation_date' | translate }}</mat-label>
          <input matInput readonly placeholder="dd/mm/yyyy" [(ngModel)]="booking.confirmation_date">
        </mat-form-field>
      </div>

    </div>
  </div>
  
  <h2>{{ 'application' | translate }}</h2>
  <div class="group">
    <div class="pure-g">

      <div class="pure-u-1 pure-u-lg-1-2">
        <mat-form-field>
          <mat-label>{{ 'building' | translate }}: </mat-label>
          <input matInput placeholder="{{'building' | translate}}" readonly [value]="building">
        </mat-form-field>
      </div>

      <div class="pure-u-1 pure-u-lg-1-2">
        <mat-form-field>
          <mat-label>{{ 'resource_type' | translate }}</mat-label>
          <input matInput placeholder="{{'resource_type' | translate}}" [ngModel]="resourceType" readonly>
        </mat-form-field>
      </div>

      <div class="pure-u-1 pure-u-lg-1-2">
        <mat-form-field>
          <mat-label>{{ 'flat_type' | translate }}</mat-label>
          <input matInput placeholder="{{'flat_type' | translate}}" [ngModel]="flatType" readonly>
        </mat-form-field>
      </div>

      <div class="pure-u-1 pure-u-lg-1-2">
        <mat-form-field>
          <mat-label>{{ 'place_type' | translate }}</mat-label>
          <input matInput placeholder="{{'place_type' | translate}}" [ngModel]="placeType" readonly>
        </mat-form-field>
      </div>

      <div class="pure-u-1 pure-u-lg-1-2">
        <mat-form-field *ngIf="!isEditableReason">
          <mat-label>{{ 'reasonForStay' | translate }}</mat-label>
          <input matInput placeholder="{{'reasonForStay' | translate}}" [ngModel]="reasonName" readonly>
        </mat-form-field>
        <mat-form-field *ngIf="isEditableReason">
          <mat-label>{{ 'reasonForStay' | translate }}</mat-label>
          <mat-select [(ngModel)]="selectedReason" (selectionChange)="enableSave()">
            <mat-option *ngFor="let c of lookupService.reasons" [value]="c.id">
            {{ isSpanish ? c.name : c.name_en  }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

      <div class="pure-u-1 pure-u-lg-1-2">
        <mat-form-field *ngIf="!isEditableSchool">
          <mat-label>{{ 'school/company' | translate }}</mat-label>
          <input matInput placeholder="{{ 'school/company' | translate}}" [ngModel]="schoolName" readonly>
        </mat-form-field>
        <mat-form-field *ngIf="isEditableSchool">
          <mat-label>{{ 'school/company' | translate }}</mat-label>
          <mat-select [(ngModel)]="selectedSchool" (selectionChange)="enableSave()">
            <mat-option *ngFor="let school of lookupService.schools" [value]="school.id">
            {{ school.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>      
      </div>

    </div>
  </div>

  <h2>{{ 'prices' | translate }}</h2>
  <div class="group">
    <div class="pure-g">

      <div class="pure-u-1 pure-u-lg-1">
        <mat-form-field>
          <mat-label>{{ 'resource' | translate }}</mat-label>
          <input matInput placeholder="{{ 'resource' | translate }}" [ngModel]="resourceCode" readonly>         
        </mat-form-field>
      </div>

      <div class="pure-u-1-2 pure-u-lg-1-4">
        <mat-form-field>
          <mat-label>{{ 'rent' | translate }}</mat-label>
          <input matInput placeholder="{{ 'rent' | translate }}" [ngModel]="booking.rent" readonly>
        </mat-form-field>
      </div>

      <div class="pure-u-1-2 pure-u-lg-1-4">
        <mat-form-field>
          <mat-label>{{ 'services' | translate }}</mat-label>
          <input matInput placeholder="{{ 'services' | translate }}" [ngModel]="booking.services" readonly>
        </mat-form-field>
      </div>

      <div class="pure-u-1-2 pure-u-lg-1-4">
        <mat-form-field>
          <mat-label>{{ 'limit' | translate }}</mat-label>
          <input matInput placeholder="{{ 'limit' | translate }}" [ngModel]="booking.limit" readonly>
        </mat-form-field>
      </div>

      <div class="pure-u-1-2 pure-u-lg-1-4">
        <mat-form-field>
          <mat-label>{{ 'theoricalGuarantee' | translate }}</mat-label>
          <input matInput placeholder="{{ 'theoricalGuarantee' | translate }}" [ngModel]="booking.deposit" readonly>
        </mat-form-field>
      </div>

      <table mat-table *ngIf="booking.price_list && booking.price_list.length" 
             [dataSource]="booking.price_list" class="table">
        <ng-container [matColumnDef]="col.header" *ngFor="let col of tableFormat">
          <th mat-header-cell *matHeaderCellDef>{{ col.name | translate }}</th>
          <td mat-cell *matCellDef="let element"> {{ element[col.property]}} </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

    </div>
  </div>

  <h2>{{ 'booking' | translate }}</h2>
  <div class="group">
    <div class="pure-g">

      <div class="pure-u-1-2 pure-u-lg-1-4">
        <mat-form-field>
          <mat-label>{{ 'check_in' | translate }}</mat-label>
          <input matInput [matDatepicker]="pickerFrom" [formControl]="checkingFormControl" (dateInput)="enableSave()">
          <mat-datepicker-toggle matIconSuffix [for]="pickerFrom"></mat-datepicker-toggle>
          <mat-datepicker #pickerFrom></mat-datepicker>
        </mat-form-field>
       </div>

      <div class="pure-u-1-2 pure-u-lg-1-4">
        <mat-form-field>
          <mat-label>{{ 'check_out' | translate }}</mat-label>
          <input matInput [matDatepicker]="pickerTo" [formControl]="checkoutFormControl" (dateInput)="enableSave()" >
          <mat-datepicker-toggle matIconSuffix [for]="pickerTo"></mat-datepicker-toggle>
          <mat-datepicker #pickerTo></mat-datepicker>
        </mat-form-field>
      </div>

      <div class="pure-u-1-2 pure-u-lg-1-4">
        <mat-form-field>
          <mat-label>{{ 'flight' | translate }}</mat-label>
          <input matInput placeholder="{{ 'flight' | translate }}" [(ngModel)]="flight" (change)="enableSave()">
        </mat-form-field>
      </div>

      <div class="pure-u-1-2 pure-u-lg-1-4">
        <mat-form-field>
          <mat-label>Hora de llegada </mat-label>
          <input matInput type="time" [(ngModel)]="arrival" (change)="enableSave()">
      </mat-form-field>
  
      </div>

      <div class="pure-u-1 pure-u-lg-1-2">
        <mat-form-field>
          <mat-label>{{ 'checkin_option' | translate }}</mat-label>
          <mat-select [(ngModel)]="selectedOption" (selectionChange)="enableSave()" >
            <mat-option *ngFor="let op of lookupService.checkinOptions" [value]="op.id">
            {{ isSpanish ? op.name : op.name_en  }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>

    </div>
  </div>

  <div *ngIf="booking.status.includes('alternativas')">
    <h2>{{ 'alternatives' | translate }}</h2>
    <table mat-table *ngIf="options && options.length" [dataSource]="options" class="table">
      <ng-container matColumnDef="building">
        <th mat-header-cell *matHeaderCellDef>{{ 'building' | translate }}</th>
        <td mat-cell *matCellDef="let element">
            <span>{{ element.building }}</span>
      </ng-container>
      <ng-container matColumnDef="resource_type">
        <th mat-header-cell *matHeaderCellDef>{{ 'resource_type' | translate }}</th>
        <td mat-cell *matCellDef="let element">
            <span>{{ element.resource_type }}</span>
      </ng-container>
      <ng-container matColumnDef="flat_type">
        <th mat-header-cell *matHeaderCellDef>{{ 'flat_type' | translate }}</th>
        <td mat-cell *matCellDef="let element">
            <span>{{ element.flat_type }}</span>
      </ng-container>
      <ng-container matColumnDef="place_type">
        <th mat-header-cell *matHeaderCellDef>{{ 'place_type' | translate }}</th>
        <td mat-cell *matCellDef="let element">
            <span>{{ element.place_type }}</span>
      </ng-container>
      <ng-container matColumnDef="accept">
        <th mat-header-cell *matHeaderCellDef>{{ 'accept' | translate }}</th>
        <td mat-cell *matCellDef="let element">
            <button mat-raised-button (click)="accept(element.id)">
              {{ 'accept' | translate }}
            </button>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumnsOptions"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumnsOptions;"></tr>
    </table>
  </div>

  <button mat-raised-button color="primary" (click)="save()" [disabled]="!enabledSave">
    {{ 'save' | translate }}
  </button>

  <br><br><br><br><br><br>

</ng-template>

  <!--

    <p>


    <div *ngIf="allContractsRendered">
      <h4>{{ 'contracts' | translate }}</h4>

      <div  *ngIf="contractSigned !== null" class="contract-box">
        {{ contractMessage | translate: { value: formatedDate } }}
      </div>

      <div  *ngIf="contractSigned === null" class="contract-box">
        {{ contractMessage | translate }}
      </div>

      <div class="box-pdf" style="margin-bottom: 25px;" *ngIf="contract_rent.length > 0">
        <h4>{{ 'rentContract' | translate }}</h4>
        <pdf-viewer
          class="pdf-viewer"
          [src]="contract_rent"
          [render-text]="true"
          [original-size]="true"
          [show-all]="true"
          [show-borders]="true"
          (page-rendered)="pageRenderedRent($event)"
          (after-load-complete)="afterLoadRent($event)"
        ></pdf-viewer>
        <div class="sign"*ngIf="booking.contract_signed === null">
          <button
            mat-raised-button color="primary"
            (click)="sign(RENT_CONTRACT_TYPE)"
            [disabled]="!isRentContractLoaded"
          >
            {{ 'sign' | translate }}
          </button>
        </div>
      </div>

      <div class="box-pdf" *ngIf="contract_services.length > 0">
        <h4>{{ 'serviceContract' | translate }}</h4>
        <pdf-viewer
          class="pdf-viewer"
          [src]="contract_services"
          [render-text]="true"
          [original-size]="true"
          [show-borders]="true"
          [show-all]="true"
          (page-rendered)="pageRenderedService($event)"
          (after-load-complete)="afterLoadService($event)"
        >
        </pdf-viewer>
        <div class="sign" *ngIf="booking.contract_signed === null">
          <button
            mat-raised-button color="primary"
            (click)="sign(SERVICE_CONTRACT_TYPE)"
            [disabled]="!isServiceContractLoaded"
          >
            {{ 'sign' | translate }}
          </button>
        </div>
      </div>
    </div>

  -->

<ng-template #elseBlock>
  <div>
    {{ 'errors.noBookingFound' | translate }}
  </div>
</ng-template>
